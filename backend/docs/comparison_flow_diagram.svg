<?xml version="1.0" encoding="UTF-8"?>
<svg width="2000" height="3800" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <style>
      .stage-box { fill: #e3f2fd; stroke: #1976d2; stroke-width: 2; rx: 5; }
      .process-box { fill: #fff3e0; stroke: #f57c00; stroke-width: 1.5; rx: 3; }
      .input-box { fill: #e8f5e9; stroke: #388e3c; stroke-width: 1.5; rx: 3; }
      .output-box { fill: #fce4ec; stroke: #c2185b; stroke-width: 1.5; rx: 3; }
      .arrow { stroke: #424242; stroke-width: 2; fill: none; marker-end: url(#arrowhead); }
      .text { font-family: Arial, sans-serif; font-size: 11px; }
      .title { font-family: Arial, sans-serif; font-size: 18px; font-weight: bold; }
      .stage-title { font-family: Arial, sans-serif; font-size: 14px; font-weight: bold; }
      .note { fill: #fff9c4; stroke: #f9a825; stroke-width: 1.5; rx: 3; }
      .error-note { fill: #ffcdd2; stroke: #d32f2f; stroke-width: 1.5; rx: 3; }
      .optimization-note { fill: #c8e6c9; stroke: #388e3c; stroke-width: 1.5; rx: 3; }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto">
      <polygon points="0 0, 10 3, 0 6" fill="#424242" />
    </marker>
  </defs>
  
  <!-- 標題 -->
  <text x="1000" y="30" text-anchor="middle" class="title">印鑑比對系統流程圖（優化後）</text>
  
  <!-- 階段1: 初始化 -->
  <g id="stage1">
    <rect x="50" y="60" width="1900" height="80" class="stage-box"/>
    <text x="1000" y="85" text-anchor="middle" class="stage-title">階段1: 初始化</text>
    
    <rect x="100" y="100" width="400" height="30" class="input-box"/>
    <text x="300" y="120" text-anchor="middle" class="text">Input: comparison_id, enable_rotation_search, enable_translation_search</text>
    
    <rect x="600" y="100" width="400" height="30" class="process-box"/>
    <text x="800" y="120" text-anchor="middle" class="text">Process: 創建 processing_stages，設置狀態為 PROCESSING</text>
    
    <rect x="1200" y="100" width="400" height="30" class="output-box"/>
    <text x="1400" y="120" text-anchor="middle" class="text">Output: processing_stages 結構，狀態更新</text>
    
    <line x1="500" y1="115" x2="600" y2="115" class="arrow"/>
    <line x1="1000" y1="115" x2="1200" y2="115" class="arrow"/>
  </g>
  
  <!-- 階段2: 載入圖像 -->
  <g id="stage2">
    <rect x="50" y="180" width="1900" height="200" class="stage-box"/>
    <text x="1000" y="205" text-anchor="middle" class="stage-title">階段2: 載入圖像</text>
    
    <!-- 2.1 獲取路徑 -->
    <rect x="100" y="220" width="350" height="30" class="input-box"/>
    <text x="275" y="240" text-anchor="middle" class="text">Input: db_comparison.image1.file_path, image2.file_path</text>
    
    <rect x="550" y="220" width="350" height="30" class="process-box"/>
    <text x="725" y="240" text-anchor="middle" class="text">Process: 標準化路徑，驗證文件存在</text>
    
    <rect x="1000" y="220" width="350" height="30" class="output-box"/>
    <text x="1175" y="240" text-anchor="middle" class="text">Output: image1_path_obj, image2_path_obj</text>
    
    <line x1="450" y1="235" x2="550" y2="235" class="arrow"/>
    <line x1="900" y1="235" x2="1000" y2="235" class="arrow"/>
    
    <!-- 2.2 讀取 bbox -->
    <rect x="100" y="270" width="350" height="30" class="input-box"/>
    <text x="275" y="290" text-anchor="middle" class="text">Input: image1.seal_bbox, image2.seal_bbox</text>
    
    <rect x="550" y="270" width="350" height="30" class="process-box"/>
    <text x="725" y="290" text-anchor="middle" class="text">Process: 讀取裁切區域信息（可選）</text>
    
    <rect x="1000" y="270" width="350" height="30" class="output-box"/>
    <text x="1175" y="290" text-anchor="middle" class="text">Output: bbox1, bbox2 (可為 None)</text>
    
    <line x1="450" y1="285" x2="550" y2="285" class="arrow"/>
    <line x1="900" y1="285" x2="1000" y2="285" class="arrow"/>
    
    <!-- 2.3 載入並裁切 -->
    <rect x="100" y="320" width="350" height="30" class="input-box"/>
    <text x="275" y="340" text-anchor="middle" class="text">Input: image1_path_obj, image2_path_obj, bbox1, bbox2</text>
    
    <rect x="550" y="320" width="350" height="30" class="process-box"/>
    <text x="725" y="340" text-anchor="middle" class="text">Process: cv2.imread(), 根據 bbox 裁切（如有）</text>
    
    <rect x="1000" y="320" width="350" height="30" class="output-box"/>
    <text x="1175" y="340" text-anchor="middle" class="text">Output: img1_cropped, img2_cropped</text>
    
    <line x1="450" y1="335" x2="550" y2="335" class="arrow"/>
    <line x1="900" y1="335" x2="1000" y2="335" class="arrow"/>
  </g>
  
  <!-- 階段3: 圖像1去背景 -->
  <g id="stage3">
    <rect x="50" y="420" width="1900" height="120" class="stage-box"/>
    <text x="1000" y="445" text-anchor="middle" class="stage-title">階段3: 圖像1去背景（已移除對齊步驟）</text>
    
    <rect x="100" y="460" width="400" height="30" class="input-box"/>
    <text x="300" y="480" text-anchor="middle" class="text">Input: img1_cropped</text>
    
    <rect x="600" y="460" width="400" height="30" class="process-box"/>
    <text x="800" y="480" text-anchor="middle" class="text">Process: _auto_detect_bounds_and_remove_background()</text>
    
    <rect x="1200" y="460" width="400" height="30" class="output-box"/>
    <text x="1400" y="480" text-anchor="middle" class="text">Output: img1_no_bg (去背景後的圖像1)</text>
    
    <line x1="500" y1="475" x2="600" y2="475" class="arrow"/>
    <line x1="1000" y1="475" x2="1200" y2="475" class="arrow"/>
    
    <!-- 保存圖像1 -->
    <rect x="100" y="500" width="400" height="30" class="process-box"/>
    <text x="300" y="520" text-anchor="middle" class="text">Process: 保存 img1_no_bg 到 image1_cropped_path</text>
    
    <rect x="600" y="500" width="400" height="30" class="output-box"/>
    <text x="800" y="520" text-anchor="middle" class="text">Output: image1_for_comparison (文件路徑)</text>
    
    <line x1="500" y1="515" x2="600" y2="515" class="arrow"/>
    
    <!-- 注意 -->
    <rect x="1450" y="460" width="400" height="70" class="note"/>
    <text x="1650" y="480" text-anchor="middle" class="text" style="font-weight: bold;">注意</text>
    <text x="1650" y="500" text-anchor="middle" class="text" style="font-size: 10px;">圖像1只進行去背景處理</text>
    <text x="1650" y="520" text-anchor="middle" class="text" style="font-size: 10px;">不對齊（_align_image1已移除）</text>
  </g>
  
  <!-- 階段4: 圖像2去背景和對齊 -->
  <g id="stage4">
    <rect x="50" y="580" width="1900" height="200" class="stage-box"/>
    <text x="1000" y="605" text-anchor="middle" class="stage-title">階段4: 圖像2去背景和對齊（相對於圖像1優化）</text>
    
    <!-- 4.1 去背景 -->
    <rect x="100" y="630" width="350" height="30" class="input-box"/>
    <text x="275" y="650" text-anchor="middle" class="text">Input: img2_cropped</text>
    
    <rect x="550" y="630" width="350" height="30" class="process-box"/>
    <text x="725" y="650" text-anchor="middle" class="text">Process: _auto_detect_bounds_and_remove_background()</text>
    
    <rect x="1000" y="630" width="350" height="30" class="output-box"/>
    <text x="1175" y="650" text-anchor="middle" class="text">Output: img2_no_bg (去背景後的圖像2)</text>
    
    <line x1="450" y1="645" x2="550" y2="645" class="arrow"/>
    <line x1="900" y1="645" x2="1000" y2="645" class="arrow"/>
    
    <!-- 4.2 對齊優化 -->
    <rect x="100" y="680" width="350" height="30" class="input-box"/>
    <text x="275" y="700" text-anchor="middle" class="text">Input: img1_no_bg (參考), img2_no_bg (待對齊)</text>
    
    <rect x="550" y="680" width="350" height="30" class="process-box"/>
    <text x="725" y="700" text-anchor="middle" class="text">Process: _align_image2_to_image1()</text>
    
    <rect x="1000" y="680" width="350" height="30" class="output-box"/>
    <text x="1175" y="700" text-anchor="middle" class="text">Output: img2_aligned, rotation_angle, translation_offset</text>
    
    <line x1="450" y1="695" x2="550" y2="695" class="arrow"/>
    <line x1="900" y1="695" x2="1000" y2="695" class="arrow"/>
    
    <!-- 4.3 對齊優化詳細流程 -->
    <rect x="100" y="730" width="800" height="40" class="process-box"/>
    <text x="500" y="750" text-anchor="middle" class="text" style="font-weight: bold;">_align_image2_to_image1 詳細流程：</text>
    <text x="500" y="765" text-anchor="middle" class="text" style="font-size: 10px;">階段1: 粗搜索（縮放0.2，角度步長3°，偏移步長8px，提前終止>0.95）</text>
    <text x="500" y="780" text-anchor="middle" class="text" style="font-size: 10px;">階段2: 完整尺寸評估（動態候選數量3-7個）</text>
    <text x="500" y="795" text-anchor="middle" class="text" style="font-size: 10px;">階段3: 細搜索優化（±2度，±10像素，步長0.5度/1px）</text>
    
    <!-- 保存對齊結果 -->
    <rect x="1000" y="730" width="400" height="40" class="output-box"/>
    <text x="1200" y="750" text-anchor="middle" class="text">保存 alignment_optimization 到 details</text>
    <text x="1200" y="770" text-anchor="middle" class="text" style="font-size: 10px;">包含: rotation_angle, translation_offset,</text>
    <text x="1200" y="785" text-anchor="middle" class="text" style="font-size: 10px;">similarity, similarity_metrics</text>
    
    <line x1="900" y1="750" x2="1000" y2="750" class="arrow"/>
    
    <!-- 保存圖像2 -->
    <rect x="100" y="780" width="400" height="30" class="process-box"/>
    <text x="300" y="800" text-anchor="middle" class="text">Process: 保存 img2_aligned 到 image2_cropped_path</text>
    
    <rect x="600" y="780" width="400" height="30" class="output-box"/>
    <text x="800" y="800" text-anchor="middle" class="text">Output: image2_for_comparison (文件路徑)</text>
    
    <line x1="500" y1="795" x2="600" y2="795" class="arrow"/>
  </g>
  
  <!-- 階段5: 計算相似度 -->
  <g id="stage5">
    <rect x="50" y="820" width="1900" height="200" class="stage-box"/>
    <text x="1000" y="845" text-anchor="middle" class="stage-title">階段5: 計算相似度（圖像已對齊，不需要旋轉/平移搜索）</text>
    
    <rect x="100" y="870" width="350" height="30" class="input-box"/>
    <text x="275" y="890" text-anchor="middle" class="text">Input: image1_for_comparison, image2_for_comparison</text>
    
    <rect x="550" y="870" width="350" height="30" class="process-box"/>
    <text x="725" y="890" text-anchor="middle" class="text">Process: compare_files() - 載入圖像並轉換為灰度</text>
    
    <rect x="1000" y="870" width="350" height="30" class="output-box"/>
    <text x="1175" y="890" text-anchor="middle" class="text">Output: img1_processed, img2_processed (灰度圖)</text>
    
    <line x1="450" y1="885" x2="550" y2="885" class="arrow"/>
    <line x1="900" y1="885" x2="1000" y2="885" class="arrow"/>
    
    <!-- 相似度計算指標 -->
    <rect x="100" y="920" width="350" height="30" class="input-box"/>
    <text x="275" y="940" text-anchor="middle" class="text">Input: img1_final, img2_final (原始尺寸，不調整)</text>
    
    <rect x="550" y="920" width="350" height="30" class="process-box"/>
    <text x="725" y="940" text-anchor="middle" class="text">Process: 計算多種相似度指標</text>
    
    <rect x="1000" y="920" width="350" height="30" class="output-box"/>
    <text x="1175" y="940" text-anchor="middle" class="text">Output: similarity_ssim, similarity_template, pixel_similarity, histogram_similarity</text>
    
    <line x1="450" y1="935" x2="550" y2="935" class="arrow"/>
    <line x1="900" y1="935" x2="1000" y2="935" class="arrow"/>
    
    <!-- 最終相似度 -->
    <rect x="100" y="970" width="350" height="30" class="input-box"/>
    <text x="275" y="990" text-anchor="middle" class="text">Input: 各項相似度指標</text>
    
    <rect x="550" y="970" width="350" height="30" class="process-box"/>
    <text x="725" y="990" text-anchor="middle" class="text">Process: 加權組合 (SSIM:0.4, Template:0.3, Pixel:0.2, Hist:0.1)</text>
    
    <rect x="1000" y="970" width="350" height="30" class="output-box"/>
    <text x="1175" y="990" text-anchor="middle" class="text">Output: similarity (最終相似度), is_match (是否匹配)</text>
    
    <line x1="450" y1="985" x2="550" y2="985" class="arrow"/>
    <line x1="900" y1="985" x2="1000" y2="985" class="arrow"/>
    
    <!-- 優化說明 -->
    <rect x="1450" y="920" width="400" height="80" class="optimization-note"/>
    <text x="1650" y="940" text-anchor="middle" class="text" style="font-weight: bold;">優化說明</text>
    <text x="1650" y="960" text-anchor="middle" class="text" style="font-size: 10px;">✓ 移除尺寸調整（避免圖像變形）</text>
    <text x="1650" y="975" text-anchor="middle" class="text" style="font-size: 10px;">✓ 移除未使用的指標計算</text>
    <text x="1650" y="990" text-anchor="middle" class="text" style="font-size: 10px;">✓ 圖像已對齊，不需要旋轉/平移搜索</text>
  </g>
  
  <!-- 階段6: 保存校正後圖像 -->
  <g id="stage6">
    <rect x="50" y="1060" width="1900" height="100" class="stage-box"/>
    <text x="1000" y="1085" text-anchor="middle" class="stage-title">階段6: 保存校正後圖像</text>
    
    <rect x="100" y="1100" width="400" height="30" class="input-box"/>
    <text x="300" y="1120" text-anchor="middle" class="text">Input: img1_corrected, img2_corrected (從 compare_files 返回)</text>
    
    <rect x="600" y="1100" width="400" height="30" class="process-box"/>
    <text x="800" y="1120" text-anchor="middle" class="text">Process: cv2.imwrite() 保存到 corrected_images 目錄</text>
    
    <rect x="1200" y="1100" width="400" height="30" class="output-box"/>
    <text x="1400" y="1120" text-anchor="middle" class="text">Output: image1_corrected_path, image2_corrected_path</text>
    
    <line x1="500" y1="1115" x2="600" y2="1115" class="arrow"/>
    <line x1="1000" y1="1115" x2="1200" y2="1115" class="arrow"/>
    
    <!-- 更新資料庫 -->
    <rect x="100" y="1140" width="400" height="30" class="process-box"/>
    <text x="300" y="1160" text-anchor="middle" class="text">Process: 更新 db_comparison.details，提取 alignment_optimization</text>
    
    <rect x="600" y="1140" width="400" height="30" class="output-box"/>
    <text x="800" y="1160" text-anchor="middle" class="text">Output: details 包含頂層 translation_offset 和 rotation_angle</text>
    
    <line x1="500" y1="1155" x2="600" y2="1155" class="arrow"/>
  </g>
  
  <!-- 階段7: 生成視覺化 -->
  <g id="stage7">
    <rect x="50" y="1200" width="1900" height="120" class="stage-box"/>
    <text x="1000" y="1225" text-anchor="middle" class="stage-title">階段7: 生成視覺化圖表</text>
    
    <rect x="100" y="1250" width="400" height="30" class="input-box"/>
    <text x="300" y="1270" text-anchor="middle" class="text">Input: image1_path_for_viz, image2_path_for_viz, image2_corrected_path</text>
    
    <rect x="600" y="1250" width="400" height="30" class="process-box"/>
    <text x="800" y="1270" text-anchor="middle" class="text">Process: _generate_visualizations()</text>
    
    <rect x="1200" y="1250" width="400" height="30" class="output-box"/>
    <text x="1400" y="1270" text-anchor="middle" class="text">Output: comparison_image, heatmap, overlay1, overlay2</text>
    
    <line x1="500" y1="1265" x2="600" y2="1265" class="arrow"/>
    <line x1="1000" y1="1265" x2="1200" y2="1265" class="arrow"/>
    
    <!-- 視覺化詳細 -->
    <rect x="100" y="1290" width="800" height="20" class="process-box"/>
    <text x="500" y="1305" text-anchor="middle" class="text" style="font-size: 10px;">create_correction_comparison() | create_difference_heatmap() | create_overlay_image()</text>
  </g>
  
  <!-- 階段8: 完成 -->
  <g id="stage8">
    <rect x="50" y="1360" width="1900" height="80" class="stage-box"/>
    <text x="1000" y="1385" text-anchor="middle" class="stage-title">階段8: 完成</text>
    
    <rect x="100" y="1400" width="400" height="30" class="input-box"/>
    <text x="300" y="1420" text-anchor="middle" class="text">Input: 所有處理結果</text>
    
    <rect x="600" y="1400" width="400" height="30" class="process-box"/>
    <text x="800" y="1420" text-anchor="middle" class="text">Process: 更新狀態為 COMPLETED，保存所有結果</text>
    
    <rect x="1200" y="1400" width="400" height="30" class="output-box"/>
    <text x="1400" y="1420" text-anchor="middle" class="text">Output: 完整的比對記錄（包含所有 details）</text>
    
    <line x1="500" y1="1415" x2="600" y2="1415" class="arrow"/>
    <line x1="1000" y1="1415" x2="1200" y2="1415" class="arrow"/>
  </g>
  
  <!-- 流程連接線 -->
  <line x1="1000" y1="140" x2="1000" y2="180" class="arrow"/>
  <line x1="1000" y1="380" x2="1000" y2="420" class="arrow"/>
  <line x1="1000" y1="540" x2="1000" y2="580" class="arrow"/>
  <line x1="1000" y1="780" x2="1000" y2="820" class="arrow"/>
  <line x1="1000" y1="1020" x2="1000" y2="1060" class="arrow"/>
  <line x1="1000" y1="1160" x2="1000" y2="1200" class="arrow"/>
  <line x1="1000" y1="1320" x2="1000" y2="1360" class="arrow"/>
  
  <!-- 潛在問題和優化建議 -->
  <g id="issues">
    <rect x="50" y="1480" width="1900" height="300" class="error-note"/>
    <text x="1000" y="1505" text-anchor="middle" class="text" style="font-weight: bold; font-size: 14px;">潛在問題和優化建議</text>
    
    <!-- 問題1 -->
    <rect x="100" y="1520" width="850" height="60" class="note"/>
    <text x="525" y="1540" text-anchor="middle" class="text" style="font-weight: bold;">問題1: 圖像1未對齊</text>
    <text x="525" y="1555" text-anchor="middle" class="text" style="font-size: 10px;">圖像1只進行了去背景處理，沒有對齊（_align_image1已移除調用）</text>
    <text x="525" y="1570" text-anchor="middle" class="text" style="font-size: 10px;">這可能導致圖像1和圖像2的基準不一致，影響比對準確度</text>
    <text x="525" y="1585" text-anchor="middle" class="text" style="font-size: 10px; font-weight: bold;">建議: 考慮對圖像1也進行基本對齊（中心對齊），或確保圖像1已經是標準化狀態</text>
    
    <!-- 問題2 -->
    <rect x="1050" y="1520" width="850" height="60" class="note"/>
    <text x="1475" y="1540" text-anchor="middle" class="text" style="font-weight: bold;">問題2: 對齊搜索可能較慢</text>
    <text x="1475" y="1555" text-anchor="middle" class="text" style="font-size: 10px;">_align_image2_to_image1 使用三階段搜索，雖然已優化（縮放0.2，角度3度）</text>
    <text x="1475" y="1570" text-anchor="middle" class="text" style="font-size: 10px;">但對於大圖像，粗搜索階段仍可能較慢</text>
    <text x="1475" y="1585" text-anchor="middle" class="text" style="font-size: 10px; font-weight: bold;">建議: 考慮使用多線程或GPU加速，或進一步優化搜索策略</text>
    
    <!-- 問題3 -->
    <rect x="100" y="1600" width="850" height="60" class="note"/>
    <text x="525" y="1620" text-anchor="middle" class="text" style="font-weight: bold;">問題3: 相似度計算未考慮尺寸差異</text>
    <text x="525" y="1635" text-anchor="middle" class="text" style="font-size: 10px;">當前流程移除了尺寸調整，直接使用原始尺寸計算相似度</text>
    <text x="525" y="1650" text-anchor="middle" class="text" style="font-size: 10px;">如果兩個圖像尺寸差異很大，可能影響相似度計算準確度</text>
    <text x="525" y="1665" text-anchor="middle" class="text" style="font-size: 10px; font-weight: bold;">建議: 考慮在計算相似度前進行智能尺寸標準化（保持長寬比）</text>
    
    <!-- 問題4 -->
    <rect x="1050" y="1600" width="850" height="60" class="note"/>
    <text x="1475" y="1620" text-anchor="middle" class="text" style="font-weight: bold;">問題4: 圖像保存重複</text>
    <text x="1475" y="1635" text-anchor="middle" class="text" style="font-size: 10px;">圖像在載入階段保存一次（image1_cropped_path, image2_cropped_path）</text>
    <text x="1475" y="1650" text-anchor="middle" class="text" style="font-size: 10px;">在保存階段又保存一次（image1_corrected_path, image2_corrected_path）</text>
    <text x="1475" y="1665" text-anchor="middle" class="text" style="font-size: 10px; font-weight: bold;">建議: 統一保存邏輯，避免重複保存相同圖像</text>
    
    <!-- 優化建議 -->
    <rect x="100" y="1680" width="1800" height="80" class="optimization-note"/>
    <text x="1000" y="1700" text-anchor="middle" class="text" style="font-weight: bold; font-size: 12px;">優化建議總結</text>
    <text x="100" y="1720" class="text" style="font-size: 10px;">1. 考慮對圖像1進行基本對齊，確保基準一致</text>
    <text x="100" y="1735" class="text" style="font-size: 10px;">2. 優化對齊搜索：使用多線程、GPU加速，或進一步縮小搜索範圍</text>
    <text x="100" y="1750" class="text" style="font-size: 10px;">3. 智能尺寸標準化：在保持長寬比的前提下進行尺寸調整，用於相似度計算</text>
    <text x="1000" y="1720" class="text" style="font-size: 10px;">4. 統一圖像保存邏輯，避免重複保存</text>
    <text x="1000" y="1735" class="text" style="font-size: 10px;">5. 緩存中間結果，減少重複計算（如去背景結果）</text>
    <text x="1000" y="1750" class="text" style="font-size: 10px;">6. 考慮使用異步處理，提高並發性能</text>
  </g>
  
  <!-- 圖例 -->
  <g id="legend">
    <rect x="50" y="1800" width="1900" height="150" class="stage-box"/>
    <text x="1000" y="1825" text-anchor="middle" class="stage-title">圖例</text>
    
    <rect x="100" y="1840" width="150" height="30" class="input-box"/>
    <text x="175" y="1860" text-anchor="middle" class="text">Input</text>
    
    <rect x="300" y="1840" width="150" height="30" class="process-box"/>
    <text x="375" y="1860" text-anchor="middle" class="text">Process</text>
    
    <rect x="500" y="1840" width="150" height="30" class="output-box"/>
    <text x="575" y="1860" text-anchor="middle" class="text">Output</text>
    
    <rect x="700" y="1840" width="150" height="30" class="note"/>
    <text x="775" y="1860" text-anchor="middle" class="text">注意/說明</text>
    
    <rect x="900" y="1840" width="150" height="30" class="optimization-note"/>
    <text x="975" y="1860" text-anchor="middle" class="text">優化說明</text>
    
    <rect x="1100" y="1840" width="150" height="30" class="error-note"/>
    <text x="1175" y="1860" text-anchor="middle" class="text">問題/錯誤</text>
    
    <!-- 最新變更 -->
    <rect x="1300" y="1840" width="600" height="100" class="optimization-note"/>
    <text x="1600" y="1860" text-anchor="middle" class="text" style="font-weight: bold;">最新變更（已實施）</text>
    <text x="1600" y="1880" text-anchor="middle" class="text" style="font-size: 10px;">• 圖像1：只去背景，不對齊（_align_image1 已移除調用）</text>
    <text x="1600" y="1895" text-anchor="middle" class="text" style="font-size: 10px;">• 圖像2：去背景 + 對齊優化（使用 _align_image2_to_image1）</text>
    <text x="1600" y="1910" text-anchor="middle" class="text" style="font-size: 10px;">• 對齊搜索優化：縮放0.2，角度3度，偏移8px，提前終止，動態候選</text>
    <text x="1600" y="1925" text-anchor="middle" class="text" style="font-size: 10px;">• 移除尺寸調整：直接使用原始尺寸計算相似度</text>
    <text x="1600" y="1940" text-anchor="middle" class="text" style="font-size: 10px;">• 移除未使用的指標計算（edge_similarity, exact_match_ratio, mse_similarity）</text>
  </g>
</svg>
